
# Airflow Pipelines

## Initialization

```docker-compose build```

### Start services

```docker compose up -d```

* Server runs at http://localhost:8080
* Remote server at http://91.107.202.58:8080

## Dependencies

To include dependancies to airflow:

    1. update `requiremnets.txt` file  
    2. run `docker-compose build` again.

Pipfile is for development only so for IDE support run
```bash
pipenv install 
```
inside a `pipenv environmnet`.
## Variables

* For password encryption airflow uses fernet key. Run:
```bash
python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
```
and set `[core] -> fernet_key` or `AIRFLOW__CORE__FERNET_KEY` variable.


## Structure

* `config`, `core`, `dags`, `logs` and `plugins` directories are mounted inside the airflow container so changes in those directories affect airflow at runtime.
* `./config/custom_airflow.cfg` contains the airflow configuration that follows the `INI Format`. You can access config variables like this:
```python
from airflow.configuration import conf

variable = conf.get("header", "variable")
```

* `config` directory: Where airflow, kubernetes and other config files live.
* `core` directory: Everything that `dags` can use and share like utility functions or constants.
* `logs` directory: Autogenerated logs from running dags.
* `plugins` directory: Code for custom airflow commands and other extensions to enhance airflow functionality.
* `dags` directory: Where airflow dags live. Under `dags` there also directories like `data` and `tmp` which are intended for dag's byproducts.

---

> Dag (Directed Acyclic Graph)
> * Directed: This means that the graph has edges (or connections between nodes) that have a direction. The direction indicates the flow of execution.
> * Acyclic: This means there are no cycles, or loops, in the graph. Once you move in a certain direction, you can't go back to a node (task) youâ€™ve already visited. This prevents infinite loops and ensures a clear execution order.
> * Graph: A graph is a collection of nodes (also called vertices) and edges (the connections between nodes). In this case, the nodes represent tasks, and the edges represent dependencies between those tasks.